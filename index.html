<!DOCTYPE html>
<html lang="hr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QUICKMIG 300 – FULL SIMULATOR</title>
    <style>
        :root { --red: #ff2b2b; --green: #2ecc71; --orange: #f39c12; }
        body { background: #111; font-family: 'Segoe UI', sans-serif; color: #eee; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .panel { width: 95%; max-width: 500px; background: #222; border-radius: 20px; padding: 25px; box-shadow: 0 20px 60px #000; border: 2px solid #333; }
        
        /* Zasloni */
        .display-unit { display: flex; gap: 15px; margin-bottom: 25px; }
        .led { flex: 1; background: #000; color: #f00; font-family: monospace; font-size: 40px; text-align: center; padding: 15px; border-radius: 10px; border: 2px solid #444; box-shadow: inset 0 0 15px #500; }
        .label { font-size: 11px; color: #888; text-align: center; margin-top: 5px; letter-spacing: 1px; }

        /* Analiza */
        .status-box { background: #000; padding: 15px; border-radius: 10px; text-align: center; border-left: 5px solid #444; min-height: 60px; transition: 0.3s; }
        .status-title { font-weight: bold; font-size: 18px; margin-bottom: 5px; }
        .status-desc { font-size: 13px; color: #888; }

        /* Kontrole */
        .controls { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 25px 0; }
        input[type=range] { width: 100%; cursor: pointer; accent-color: var(--red); }
        
        .btn { width: 100%; padding: 15px; border-radius: 8px; border: none; font-weight: bold; color: white; cursor: pointer; transition: 0.2s; background: #333; }
        .btn.active { background: var(--red); box-shadow: 0 0 20px rgba(255,43,43,0.4); }
        
        /* Dinamičke klase za rezultat */
        .good-weld { border-left-color: var(--green); color: var(--green); }
        .cold-weld { border-left-color: var(--red); color: var(--red); }
        .hot-weld { border-left-color: var(--orange); color: var(--orange); }
    </style>
</head>
<body>

<div class="panel">
    <h2 style="text-align:center; color:var(--red); letter-spacing:2px;">LINCOLN PRO SIM</h2>

    <div class="display-unit">
        <div>
            <div class="led" id="val_w">5.0</div>
            <div class="label">ŽICA m/min</div>
        </div>
        <div>
            <div class="led" id="val_v">19.0</div>
            <div class="label">NAPON V</div>
        </div>
    </div>

    <div class="status-box" id="box">
        <div class="status-title" id="st_title">SPREMAN ZA RAD</div>
        <div class="status-desc" id="st_desc">Pritisni gumb 'WELD' za simulaciju luka.</div>
    </div>

    <div class="controls">
        <div>
            <input type="range" id="sl_w" min="10" max="150" value="50" oninput="run()">
            <div class="label">BRZINA ŽICE</div>
        </div>
        <div>
            <input type="range" id="sl_v" min="100" max="320" value="190" oninput="run()">
            <div class="label">NAPON</div>
        </div>
    </div>

    <div style="display:flex; gap:10px;">
        <button id="synBtn" class="btn active" onclick="toggleSyn()">SYNERGIC</button>
        <button id="weldBtn" class="btn" onmousedown="startWeld()" onmouseup="stopWeld()" ontouchstart="startWeld()" ontouchend="stopWeld()">DRŽI ZA VAR (WELD)</button>
    </div>
</div>

<script>
    let syn = true;
    let audioCtx = null;
    let oscillator = null;
    let noiseNode = null;

    function toggleSyn() {
        syn = !syn;
        document.getElementById('synBtn').classList.toggle('active');
        run();
    }

    function run() {
        let w = document.getElementById('sl_w').value / 10;
        let v = document.getElementById('sl_v').value / 10;

        if (syn) {
            v = 14 + w;
            document.getElementById('sl_v').value = v * 10;
        }

        document.getElementById('val_w').innerText = w.toFixed(1);
        document.getElementById('val_v').innerText = v.toFixed(1);

        updateAnalysis(w, v);
    }

    function updateAnalysis(w, v) {
        const b = document.getElementById('box');
        const t = document.getElementById('st_title');
        const d = document.getElementById('st_desc');
        let diff = v - (14 + w);

        b.className = "status-box";

        if (Math.abs(diff) <= 1.2) {
            b.classList.add('good-weld');
            t.innerText = "OPTIMALAN LUK";
            d.innerText = "Savršen prijenos kapi. Zvuk 'prženja slanine'.";
        } else if (diff < -1.2) {
            b.classList.add('cold-weld');
            t.innerText = "HLADAN VAR";
            d.innerText = "Žica zabija u talinu. Nestabilan luk, loš uvar.";
        } else {
            b.classList.add('hot-weld');
            t.innerText = "PREDUG LUK";
            d.innerText = "Puno prskanja, širok i plitak var. Pregrijavanje.";
        }
    }

    // AUDIO ENGINE - Generiranje zvuka zavarivanja u realnom vremenu
    function startWeld() {
        if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        let w = document.getElementById('sl_w').value / 10;
        let v = document.getElementById('sl_v').value / 10;
        let diff = v - (14 + w);

        // Bijeli šum za bazu zvuka
        let bufferSize = 2 * audioCtx.sampleRate,
            noiseBuffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate),
            output = noiseBuffer.getChannelData(0);
        for (let i = 0; i < bufferSize; i++) output[i] = Math.random() * 2 - 1;

        noiseNode = audioCtx.createBufferSource();
        noiseNode.buffer = noiseBuffer;
        noiseNode.loop = true;

        let filter = audioCtx.createBiquadFilter();
        let gainNode = audioCtx.createGain();

        // Prilagodba zvuka prema kvaliteti vara
        if (Math.abs(diff) <= 1.2) { // DOBAR
            filter.type = 'bandpass';
            filter.frequency.value = 800;
            gainNode.gain.value = 0.3;
        } else if (diff < -1.2) { // HLADNO - Pucketanje
            filter.type = 'highpass';
            filter.frequency.value = 2000;
            gainNode.gain.value = 0.5;
        } else { // VRUĆE - Duboko brujanje
            filter.type = 'lowpass';
            filter.frequency.value = 400;
            gainNode.gain.value = 0.6;
        }

        noiseNode.connect(filter);
        filter.connect(gainNode);
        gainNode.connect(audioCtx.destination);
        noiseNode.start();
        
        document.getElementById('weldBtn').style.background = "#ffae00";
    }

    function stopWeld() {
        if (noiseNode) {
            noiseNode.stop();
            document.getElementById('weldBtn').style.background = "#333";
        }
    }

    window.onload = run;
</script>
</body>
</html>
